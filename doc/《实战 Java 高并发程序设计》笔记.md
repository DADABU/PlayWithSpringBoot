# 相关的概念
为什么要使用并行程序？一，为了获得更好的性能；二，由于业务模型的需要，确实需要多个执行实体。

### 同步和异步

同步和异步通常来描述一个方法的调用

- 同步(Synchronous)：同步方法调用一旦开始，调用者必须等到方法调用返回后，才能继续后续的行为。

- 异步(Asynchronous)：异步方法调用更像一个消息的传递，调用后调用者可以继续后续的操作，而异步的方法通常在另一个线程中被执行，如果异步调用需要返回结果，那么异步方法在完成时会通知调用者。

### 并发和并行

这是两个很容易混淆的概念，都可以表示两个或多个任务一起执行，但是偏重点有些不同。

- 并发(Concurrency)：多个任务交替被执行，而多个任务之间有可能还是串行的。

- 并行(Parallelism)：是真正的多个任务同时被执行

> 由于一个 CPU 核心只能运行一条指令，所以真实的并行只可能发生在多核 CPU 的电脑上。

### 临界区

临界区表示一种公共资源或者说是共享数据，可被多个线程使用。但是每一次只能有一个线程使用它，一旦临界区的资源被占用，其他线程要想使用这个资源就必须等待。

### 阻塞和非阻塞

阻塞和非阻塞通常形容多线程间的相互影响。

- 阻塞(Blocking)：当一个线程占用了临界区的资源，其他的所有的线程都在这个临界区等待，导致线程挂起，这种情况就是阻塞。

- 非阻塞(Non-Blocking)：非阻塞强调没有一个线程可以妨碍其他线程执行，所有的线程都会尝试不断前向执行。

### 死锁、饥饿和活锁

死锁、饥饿和活锁都属于线程活跃性问题。

- 死锁(DeadLock)：死锁出现于多个线程直接所占有的资源和所等待的资源的冲突导致，如：线程A占用着记录1等待记录2，线程B占用着记录2等待记录1。

- 饥饿(Starvation)：饥饿是指一个或多个线程因为种种原因无法获得所需要的资源，导致一直无法执行。与死锁相比，饥饿还是有可能在未来一段时间内解决的。

- 活锁(LiveLock)：在两个或多个线程在秉着“谦让”的态度，主动将自己所占有的资源让给他人使用，这时资源在线程之间跳来跳去导致没有一个线程能同时拥有所有需要的资源，从而没有一个线程能顺利的执行。

### 并发的级别
由于临界区的存在，多线程之间的并发必须受到控制。根据控制并发的策略，我们可以把并发级别分类，大致上可以分为阻塞、无饥饿、无障碍、无锁、无等待几种。

- 阻塞(Blocking)：一个线程是阻塞的时候，在其他线程释放该线程所需要的资源之前，当前线程无法继续执行。当我们使用 `synchronized` 关键字，或重入锁时我们得到的就是阻塞的线程。

- 无饥饿(Starvation-Free)：如果线程间是有优先级的，那么系统总是倾向于满足优先级别高的线程。也就是说线程之间是不公平的，可能导致有的线程饥饿。如果是公平线程的话，即所有的线程都需要排队来等待资源，那么可以做到无饥饿。

- 无障碍(Obstruction-Free)：无障碍是最弱的非阻塞调度，两个或多个线程无障碍的执行，他们不会因为临界区的问题导致一方被挂起。如果出现了一起修改共享数据的情况时，以保护数据为第一优先级，对自己的修改做回滚，确保数据安全。

- 无锁(Lock-Free)：无锁的并行都是无障碍的。无锁的线程都能尝试对临界区进行访问，他会不断的尝试修改共享变量。如果没有冲突，修改成功，程序退出，否则继续尝试修改。

- 无等待(Wait-Free)：一种典型的无等待结构是 RCU (Read-Copy-Update) 基本思想为对于读操作不加控制，对于写先获取原始数据的副本，接着只修改副本数据，修改完成后，在合适的时机回写数据。

### Amdahl 定律
> 加速比定义： 加速比 = 优化前系统耗时 / 优化后系统耗时

即，所谓的加速比，就是优化前后耗时的比值。加速比越高则表明优化效果越明显。

### Gustafson 定律
和 Amdahl 定律一样，Gustafson 定律也试图说明处理器个数、串行比例和加速比的关系，不过 G 定律提供了一个不同的视角。

### Java 内存模型(JMM)

并行程序比串行程序复杂得多，其中一个很重要的原因是并发程序下的数据访问的一致性和安全性将会受到严重挑战。JMM 就是为了解决多线程间有效的、正确地协同工作。

> JMM 的关键技术点都是围绕着多线程的原子性、可见性和有序性来建立的。

- 原子性(Atomicity)：原子性是指一个操作是不可中断的。即使是在多个线程一起执行的时候，一个操作开始，就不会受其他的线程影响。

- 可见性(Visibility)：可见性是指当一个线程修改了某一个共享变量的值，其他线程是否能够立即知道这个修改。

- 有序性(Ordering)：有序性是最难理解的


